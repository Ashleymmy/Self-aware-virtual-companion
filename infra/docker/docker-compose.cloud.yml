name: savc-cloud

services:
  savc-gateway:
    image: ${SAVC_GATEWAY_IMAGE:-savc-openclaw:dev}
    build:
      context: ../../openclaw
      dockerfile: Dockerfile
    init: true
    restart: unless-stopped
    working_dir: /app
    user: "0:0"
    environment:
      HOME: /home/node
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      ANYROUTER_API_KEY: ${ANYROUTER_API_KEY:-}
      GGBOOM_API_KEY: ${GGBOOM_API_KEY:-}
      CODE_API_KEY: ${CODE_API_KEY:-}
      LAOYOU_API_KEY: ${LAOYOU_API_KEY:-}
      SILICON_EMBEDDING_API_KEY: ${SILICON_EMBEDDING_API_KEY:-}
    volumes:
      - ../../:/workspace
      - savc_openclaw_state:/home/node/.openclaw
    command:
      - sh
      - -lc
      - |
        set -e
        mkdir -p /home/node/.openclaw
        if [ ! -f /home/node/.openclaw/openclaw.json ]; then
          cp /workspace/infra/docker/openclaw.container.json /home/node/.openclaw/openclaw.json
        fi
        node dist/index.js gateway --allow-unconfigured --bind lan --port 18789
    ports:
      - "${OPENCLAW_GATEWAY_PORT:-18789}:18789"
    healthcheck:
      test: ["CMD-SHELL", "node -e \"fetch('http://127.0.0.1:18789/health').then(r=>process.exit(r.ok?0:1)).catch(()=>process.exit(1))\""]
      interval: 15s
      timeout: 5s
      retries: 5

volumes:
  savc_openclaw_state:
