# 密钥轮换与本地凭据管理

> 更新时间: 2026-02-19
> 适用范围: `Self-aware-virtual-companion` 仓库

## 1. 基本原则

- 所有密钥、令牌、账号密码仅允许放在 `config/.env.local`。
- `config/.env.local` 已被 `.gitignore` 忽略，严禁手动强制提交。
- 文档、日志、测试产物中禁止出现真实凭据。

## 2. 泄露应急流程

1. 在对应平台立即吊销旧密钥（OpenAI、Discord、Telegram、Twilio、Telnyx、ngrok 等）。
2. 生成新密钥并更新 `config/.env.local`。
3. 重新启动依赖服务（如 `scripts/dev.sh`）。
4. 检查当前仓库与暂存区是否仍有疑似泄露内容：
   - `pnpm security:scan`
   - `pnpm security:scan:staged`
5. 若历史提交疑似泄露，追加安全事件记录并执行历史清理流程。

## 3. 提交前防护

- 安装 Git hooks（一次即可）：

```bash
pnpm hooks:install
```

- 手动执行扫描：

```bash
pnpm security:scan:staged
```

- 说明：扫描默认跳过 `openclaw/`（上游源码目录，含测试假数据）。如需全量包含执行：

```bash
SAVC_SCAN_INCLUDE_OPENCLAW=1 pnpm security:scan
```

## 4. 本地凭据维护建议

- 新成员初始化时仅复制模板：
  - `cp config/.env.example config/.env.local`
- 使用最小权限的 API Key，避免共享主账号高权限密钥。
- 按渠道拆分凭据，便于定向轮换和追踪。
- 每次轮换后同步更新内部记录（不记录明文值，只记录轮换时间和负责人）。
