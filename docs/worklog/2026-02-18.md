# 2026-02-18 工作日志

## 1) `savc-ui` 真实接口梳理
- 对话目标: 回答“`savc-ui` 里哪些接口已实现并调用真实数据”。
- 执行内容:
  - 扫描 `savc-ui/src` 中 `fetch`、`WebSocket`、`gateway`、`mock` 相关调用。
  - 逐个核对页面层调用来源，区分真实网关接口与本地 mock 数据。
  - 确认真实接口集中在 Live2D 信号桥接与日志页网关 RPC，两者分别走 HTTP 与 WebSocket。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
  - `docs/worklog/INDEX.md`
- 验证结果:
  - 通过 `rg -n "\\bfetch\\(" savc-ui/src -S` 确认仅有两处网络请求入口。
  - 通过 `rg -n "logs.tail|status|health|tools/invoke|mock" savc-ui/src -S` 交叉确认真实与 mock 调用边界。
- 备注:
  - 本轮仅做代码梳理，无业务代码改动。

## 2) `savc-ui` 接口改造为真实数据优先
- 对话目标: 按要求将 `savc-ui` 页面接口改为真实数据对接。
- 执行内容:
  - 重写 `savc-ui/src/ui/mock/index.ts`，实现 `GatewayDataClient`，通过网关 RPC 拉取真实数据并统一暴露给 UI。
  - 将仪表盘、记忆、人格、编排、会话发送等接口改为真实网关数据映射，保留网关不可用时的本地兜底。
  - 更新 `savc-ui/src/ui/views/chat.ts`，发送消息优先调用 `gateway.sendChatMessage()`，失败时回退本地回复逻辑。
  - 修复 TypeScript 推断问题（`reduce` 明确为 `reduce<number>(...)`）。
- 修改文件:
  - `savc-ui/src/ui/mock/index.ts`
  - `savc-ui/src/ui/views/chat.ts`
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `pnpm --dir savc-ui exec tsc -p tsconfig.json --noEmit` 通过。
  - `pnpm --dir savc-ui build` 通过。
- 备注:
  - 当前实现为“真实数据优先 + 失败兜底”，确保网关不可用时页面仍可用。

## 3) 端口独立性核对（`savc-ui` vs OpenClaw 网关）
- 对话目标: 确认 `savc-ui` 服务端口与 OpenClaw 原生网关端口不冲突、保持独立。
- 执行内容:
  - 核对 `config/.env.local`、`scripts/dev.sh`、`savc-ui/package.json`、`savc-ui/vite.config.ts` 的端口配置。
  - 复核启动脚本 `scripts/start_project.ps1`，确认其只重启网关，不复用 `savc-ui` 端口配置。
  - 结论：网关使用 `18789`（`OPENCLAW_PORT`/`OPENCLAW_GATEWAY_PORT`），`savc-ui` dev server 使用 `5174`，两者独立。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 配置层检查通过：`savc-ui/package.json` 与 `savc-ui/vite.config.ts` 均固定 `5174`，网关为 `18789`。
- 备注:
  - 本轮未修改业务代码。

## 4) 网关重启与可用性确认
- 对话目标: 按用户请求重启 OpenClaw 网关，便于 `savc-ui` 联调测试。
- 执行内容:
  - 执行 `bash scripts/openclaw.sh gateway restart` 重启网关服务。
  - 重启后轮询执行 `bash scripts/openclaw.sh health`，并检查 `18789` 端口监听状态。
  - 记录重启前后主进程 PID 变化，确认服务已重新拉起。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 网关重启成功（MainPID 从 `1763861` 变更为 `1809403`）。
  - 健康检查通过（Telegram/Discord/Agents 正常）。
  - `127.0.0.1:18789` 与 `[::1]:18789` 均处于 LISTEN 状态。
- 备注:
  - 首次健康探测出现重启瞬时 `1006` 断连，随后重试即恢复正常。

## 5) `savc-ui` 5174 无法访问排障与恢复
- 对话目标: 解决 `http://localhost:5174/` 无法加载问题。
- 执行内容:
  - 检查 `5174` 监听与进程，确认当时无 `vite` dev server 运行。
  - 启动 `savc-ui` 开发服务器并改用 `setsid` 后台方式，避免会话结束导致进程退出。
  - 验证端口监听与 HTTP 响应，确认页面可正常返回 `200 OK` 与 `index.html`。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `ss -ltnp` 显示 `*:5174` 正在监听（`vite` 进程）。
  - `curl --noproxy '*' -I http://127.0.0.1:5174/` 返回 `HTTP/1.1 200 OK`。
- 备注:
  - 终端环境存在 `HTTP_PROXY`，直接 `curl` 可能走代理返回 `502`；本地联调建议对 `localhost/127.0.0.1` 走直连。

## 6) Phase 5d/6 API 与工具配置指导梳理
- 对话目标: 用户反馈部分 API 未填写、部分工具未使用过，需提供配置与获取方式指导。
- 执行内容:
  - 核对 `config/.env.example` 与 `config/.env.local` 的 Phase 5d/6 变量清单。
  - 扫描代码实际读取的环境变量，区分“已生效变量”与“仅预留变量”。
  - 核对当前 `~/.openclaw/openclaw.json`，确认 `voice-call` 插件尚未启用。
  - 查询 Twilio/Telnyx/Plivo/ngrok/ElevenLabs 官方文档入口，准备“去哪获取 key/ID”的指导链接。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 代码层确认：`VITE_SAVC_*`、`TWILIO_*`/`TELNYX_*`/`PLIVO_*`、`NGROK_*`、`ELEVENLABS_API_KEY`、`OPENAI_TTS_BASE_URL`存在实际读取。
  - 配置层确认：当前 `plugins.entries` 仅启用 `discord`/`telegram`，`voice-call` 未启用。
- 备注:
  - `VOICE_CALL_PROVIDER`、`VOICE_CALL_FROM_NUMBER`、`VOICE_CALL_TO_NUMBER`、`VOICE_TTS_*`、`SILICON_TTS_*` 当前版本主要为预留，不会自动注入插件运行配置。

## 7) 用户现有配置体检与缺项定位（语音/Live2D）
- 对话目标: 用户反馈 Plivo 不可用、Telnyx/ngrok 部分字段找不到，先体检当前配置状态。
- 执行内容:
  - 对 `config/.env.local` 的 Phase 5d/6 关键变量做“SET/EMPTY/MISSING”检查（不回显密钥）。
  - 检查 `~/.openclaw/openclaw.json`，确认 `plugins.entries.voice-call` 与 `plugins.entries.savc-orchestrator` 当前是否启用。
  - 检查 `openclaw-gateway.service` 环境注入来源，确认 systemd 已加载 `EnvironmentFile=/home/min/SAVC/Self-aware-virtual-companion/config/.env.local`。
  - 结论：当前 `VOICE_CALL_PROVIDER=mock`，且 `voice-call` 插件尚未启用；`TELNYX_CONNECTION_ID`、`NGROK_DOMAIN` 为空，`VOICE_CALL_FROM_NUMBER` 为空（切 real provider 时会成为必填）。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 变量检查成功输出状态清单（含 `TELNYX_CONNECTION_ID=EMPTY`、`NGROK_DOMAIN=EMPTY`）。
  - `openclaw config get --json plugins.entries.voice-call` 返回 `null`（未启用）。
  - systemd 服务配置确认包含 `.env.local` 环境文件注入。
- 备注:
  - 用户当前“已填了很多 key”是有效准备，但在启用 `voice-call` 并切 provider 前不会进入实际链路。

## 8) Telnyx Connection ID 获取方式澄清
- 对话目标: 回答“获取 `TELNYX_CONNECTION_ID` 是否需要下载 telnyx-toolkit”。
- 执行内容:
  - 明确说明 `TELNYX_CONNECTION_ID` 可在 Telnyx 控制台直接获取，或通过 API 查询，无需安装本地 toolkit。
  - 补充最短路径：进入 Voice/Call Control 应用详情页复制 Connection ID（UUID）。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 未执行（文档记录项）。
- 备注:
  - toolkit 不是必需前置条件。

## 9) Telnyx 控制台参数填写指导（与 SAVC 对接）
- 对话目标: 针对用户在 Telnyx 新建 Call Control Application 页面，给出逐项填写建议。
- 执行内容:
  - 核对 `voice-call` 插件实现，确认 webhook 路径默认值与 provider 校验规则：
    - 默认 webhook 路径为 `/voice/webhook`；
    - `telnyx.connectionId` 与 `fromNumber` 在非 mock 下为必需；
    - `NGROK_DOMAIN` 仅用于 ngrok 自定义域名（可选）。
  - 核对 runtime 行为，确认 `tunnel.provider=ngrok` 时可自动拉起 ngrok 并拼接 `publicUrl + /voice/webhook`。
  - 结合官方文档确认 `connection_id` 即 Call Control Application 的 App ID（Connection ID）。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 代码检查通过：`openclaw/extensions/voice-call/src/config.ts`、`openclaw/extensions/voice-call/src/runtime.ts`、`openclaw/extensions/voice-call/src/tunnel.ts`、`openclaw/extensions/voice-call/src/providers/telnyx.ts`。
  - 文档核验：Telnyx Quickstart/Help 文档确认 connection_id 来源与 Webhook API v2 建议。
- 备注:
  - 需特别提醒用户：`VOICE_CALL_PROVIDER/VOICE_CALL_FROM_NUMBER` 当前项目不自动注入插件配置，仍需写入 `plugins.entries.voice-call.config`。

## 10) 是否必须自有域名澄清（Telnyx webhook）
- 对话目标: 回答“是否需要弄一个域名”。
- 执行内容:
  - 明确区分“自有域名”与“公网可访问 HTTPS 地址”。
  - 给出最小可行方案：`mock` 模式不需要域名；`telnyx/twilio/plivo` 真实通话需要公网回调地址，但可用 ngrok 随机域名，无需自有域名。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 未执行（问答说明）。
- 备注:
  - `NGROK_DOMAIN` 为可选，仅在需要固定自定义域名时使用。

## 11) ngrok 域名值确认（按截图）
- 对话目标: 回答“截图里的 ngrok 域名是否可直接用于配置”。
- 执行内容:
  - 明确 `NGROK_DOMAIN` 需要填写 ngrok 控制台“域名/Domain”列中的主机名，而不是 ID 列。
  - 明确 `Webhook URL` 需使用 `https://<domain>/voice/webhook` 完整地址；`NGROK_DOMAIN` 只写主机名不带协议与路径。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 未执行（问答说明）。
- 备注:
  - 用户截图中的 `.ngrok-free.dev` 域名可用，前提是该域名已在 ngrok 项目下分配并能成功启动隧道。

## 12) Telnyx Inbound 页面是否需要配置
- 对话目标: 回答 Telnyx 创建应用 Step 2（Inbound）页面“还需要配置什么”。
- 执行内容:
  - 按当前 SAVC 语音联调目标给出最小配置建议：先以外呼为主，Inbound 保持最小化。
  - 给出每个字段的建议值与是否必填（SIP subdomain / receive settings / channel limit / codecs / SHAKEN-STIR）。
  - 补充安全建议：优先选 `Only My Connections`，减少暴露面。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 未执行（问答说明）。
- 备注:
  - 真实通话链路关键在后续 Outbound 与号码绑定、以及 webhook 可达性；Inbound 可后续再补。

## 13) Telnyx Outbound 页面填写指导（Step 3/4）
- 对话目标: 指导用户完成 Telnyx Create Voice API Applications 的 Outbound 配置页。
- 执行内容:
  - 说明 Outbound Voice Profile（OVP）为此页核心项，需选择已有 OVP；若下拉为空，需先在 Telnyx 控制台创建 OVP。
  - 给出最小联调值：`Outbound Channel Limit=1`（或留空走默认），先保证单路外呼稳定。
  - 关联 SAVC 约束：非 mock provider 下 `fromNumber` 必填，且 `telnyx.connectionId` 必填，避免网关侧启动后报配置错误。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 代码检查参考：`openclaw/extensions/voice-call/src/config.ts`（`fromNumber` 与 `telnyx.connectionId` 校验）、
    `openclaw/extensions/voice-call/src/providers/telnyx.ts`（发起呼叫使用 `connection_id`）。
- 备注:
  - Outbound 完成后仍需在 Telnyx Numbers 步骤绑定号码，并在本地插件配置 `fromNumber` 为该号码（E.164）。

## 15) Outbound 页面下拉为空处理（无 OVP 可选）
- 对话目标: 用户在 Outbound 页面看不到可选 OVP，需给出补救路径。
- 执行内容:
  - 依据 Telnyx 帮助文档确认：应用外呼必须先绑定 Outbound Voice Profile。
  - 提供 OVP 直达入口 `https://portal.telnyx.com/#/app/outbound-profiles`，建议先新建 OVP 再回向导刷新。
  - 补充入口缺失场景：若侧栏不显示该模块，优先检查账号角色权限（Owner/Admin）或联系 Telnyx 支持开通可见性。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 参考官方文档确认：
    - Call Control 应用 Outbound 必须指定 OVP
    - OVP 入口与创建流程
- 备注:
  - 当前截图里已有 `Select an OVP` 下拉，通常代表“模块可用但尚未创建任何 OVP”。

## 16) OVP Allowed Destinations 选择建议
- 对话目标: 指导用户在 OVP 的 `Allowed Destinations` 页面选择可外呼地区。
- 执行内容:
  - 给出最小安全策略：只勾选实际会拨打的国家/地区，避免 `Select all destinations`。
  - 说明按目标号码国家码选择：
    - 若拨打美/加号码，保留 `North America` 下对应国家（`+1`）即可；
    - 若拨打中国号码，额外勾选 `East Asia -> China (+86)`。
  - 强调保存后需回到 Voice API Application 重新选择 OVP 并继续流程。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 未执行（问答说明）。
- 备注:
  - 目的地放开过大容易引入误呼/风控风险，建议先最小范围联调。

## 17) 主动外呼暂缓策略确认
- 对话目标: 用户确认“中国号码外呼需订阅”，决定先搁置主动外呼能力。
- 执行内容:
  - 复核当前 `config/.env.local` 的语音 provider 配置，确认仍为 `VOICE_CALL_PROVIDER=mock`。
  - 复核当前网关配置，确认 `plugins.entries.voice-call` 仍未启用，不会触发真实外呼链路。
  - 给出后续策略：保留现有密钥与预留字段，待开通套餐后再切换至真实 provider。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 环境检查通过：`VOICE_CALL_PROVIDER=mock`，`plugins.entries.voice-call=null`。
- 备注:
  - 本轮不修改业务配置，保持系统稳定可用。

## 14) Outbound Voice Profiles 入口缺失排查指引
- 对话目标: 回答“Telnyx 控制台看不到 Outbound Voice Profiles 选项”。
- 执行内容:
  - 给出 Telnyx 官方入口路径与直达 URL，便于绕过侧栏入口差异。
  - 说明下拉为空的常见原因与处理顺序：先新建 OVP、再回到应用向导刷新选择。
  - 补充账号/权限可能性：若页面无权限或入口隐藏，需切管理员账号或联系 Telnyx 支持开通。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 参考官方文档：
    - `support.telnyx.com` 配置应用说明（含 Outbound Voice Profile 字段）
    - `support.telnyx.com` OVP 说明与入口
    - `developers.telnyx.com` 可编程语音 quickstart（先建 OVP 再关联应用）
- 备注:
  - 提供了 `https://portal.telnyx.com/#/app/outbound-profiles` 作为可直接访问路径。

## 18) 暂缓语音外呼后继续推进 UI 真实数据体验
- 对话目标: 按“先搁置外呼，继续别的”推进 `savc-ui`，提升真实数据可见性与刷新能力。
- 执行内容:
  - 新增数据入口别名 `savc-ui/src/ui/data/index.ts`，统一对外暴露网关数据客户端，避免页面继续直接引用 `mock` 路径造成误解。
  - 在 `GatewayDataClient` 增加 `invalidateCache()`，支持页面触发“强制刷新”时清理快照/记忆缓存后重新拉取网关。
  - 仪表盘、记忆、人格、编排页面增加“刷新”按钮与“上次刷新时间”展示，刷新时强制走最新网关数据。
  - 调整应用默认连接展示：初始状态改为未连接（`connected=false`，`uptime=--`），并更新开发中占位文案，避免继续显示“尚未对接 WebSocket”的过时提示。
- 修改文件:
  - `savc-ui/src/ui/data/index.ts`
  - `savc-ui/src/ui/mock/index.ts`
  - `savc-ui/src/ui/views/dashboard.ts`
  - `savc-ui/src/ui/views/memory.ts`
  - `savc-ui/src/ui/views/persona.ts`
  - `savc-ui/src/ui/views/orchestrator.ts`
  - `savc-ui/src/ui/views/chat.ts`
  - `savc-ui/src/ui/app-view-state.ts`
  - `savc-ui/src/ui/app.ts`
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `pnpm --dir savc-ui exec tsc -p tsconfig.json --noEmit` 通过。
  - `pnpm --dir savc-ui build` 通过。
- 备注:
  - 主动外呼链路继续保持搁置，本轮仅推进无需 Telnyx/Plivo 依赖的 UI 与数据侧改进。

## 19) 用户补充 TTS 密钥后的生效性检查与下一步指引
- 对话目标: 用户反馈“语音 TTS 密钥已添加”，需确认是否已生效、当前链路是否会实际使用。
- 执行内容:
  - 检查 `config/.env.local` 中 TTS/语音相关变量状态（仅检查 `SET/EMPTY/MISSING`，不回显敏感值）。
  - 检查当前运行配置中 `plugins.entries.voice-call` 是否已启用。
  - 复核 `voice-call` 与 core TTS 代码读取逻辑，确认哪些环境变量会被实际消费。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `ELEVENLABS_API_KEY`、`SILICON_TTS_API_KEY` 等变量已检测到为 `SET`；`OPENAI_TTS_BASE_URL`、`VOICE_TTS_ELEVENLABS_VOICE_ID` 为 `EMPTY`。
  - `VOICE_CALL_PROVIDER=mock`，且 `openclaw config get --json plugins.entries.voice-call` 返回路径不存在（未启用）。
  - 代码层确认：当前 `voice-call` 配置直接消费 `TELNYX/TWILIO/PLIVO/NGROK` 环境变量；core OpenAI TTS 使用 `OPENAI_API_KEY` 与可选 `OPENAI_TTS_BASE_URL`，`SILICON_TTS_*` 与 `VOICE_TTS_*` 目前仍属预留字段。
- 备注:
  - 本轮未改业务代码，仅做配置体检与生效路径核对。

## 20) 目标转型到消息渠道 TTS（暂停语音外呼）
- 对话目标: 用户明确先不做语音外呼，转向 WebUI/Discord/Telegram 的消息语音化（TTS）交互。
- 执行内容:
  - 将网关运行配置切换为消息 TTS 模式：`messages.tts.auto=always`、`messages.tts.mode=final`。
  - 保持 `voice-call` 插件未启用（`plugins.entries.voice-call` 不存在），继续与外呼链路隔离。
  - 重启网关并通过 RPC 验证：`tts.providers`、`tts.status`、`tts.convert`。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `openclaw gateway call tts.providers --json`：OpenAI / ElevenLabs / Edge 均显示 `configured=true`。
  - `openclaw gateway call tts.status --json`：`enabled=true`、`auto=always`、`provider=openai`（含 fallback）。
  - `openclaw gateway call tts.convert --params '{"text":"这是一条 TTS 连通性测试。"}' --json` 成功返回音频文件路径（本次落在 fallback provider）。
  - `bash scripts/openclaw.sh health`：Discord/Telegram 探活正常。
- 备注:
  - 本轮未启用语音外呼插件；重点转向消息渠道的语音化回复能力。

## 21) SAVC-UI 前端窗口可测试的 TTS 范围确认
- 对话目标: 回答“是否可以直接在 savc-ui 前端窗口测试 TTS”。
- 执行内容:
  - 检查 `5174` 端口监听与 HTTP 可达性。
  - 检查 `savc-ui` 聊天页语音链路实现，确认其使用浏览器 `speechSynthesis` 与 Live2D 语音信号。
  - 对比消息渠道 TTS（`messages.tts`）与 savc-ui 前端 TTS 的链路差异。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `ss -ltnp` 显示 `*:5174` 正在监听。
  - `curl http://127.0.0.1:5174/` 返回 `200`。
  - 代码检查确认 `savc-ui/src/ui/views/chat.ts` 调用浏览器 `window.speechSynthesis.speak(...)`，不直接调用 `tts.convert` 网关方法。
- 备注:
  - 可在 savc-ui 测“前端本地播报体验”；若要测 Discord/Telegram 同链路，应在消息渠道侧验证 `messages.tts`。

## 22) 用户确认 savc-ui 是否调用 messages.tts API
- 对话目标: 回答“savc-ui 里是否调用了相关 TTS API”。
- 执行内容:
  - 基于现有代码检查结果给出结论：区分“消息渠道 TTS API（messages.tts / tts.convert）”与“savc-ui 前端本地播报链路（speechSynthesis）”。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - 代码层已确认 `savc-ui` 聊天页使用浏览器 `speechSynthesis`，未直接调用 `tts.convert`。
- 备注:
  - `savc-ui` 仍会调用网关其他接口（如聊天、health/status、Live2D 相关）。

## 23) 全面接入 TTS：savc-ui 改为网关 TTS 优先并保留浏览器回退
- 对话目标: 按用户“全面接入 TTS”的要求，将 savc-ui 从本地 `speechSynthesis` 单一路径升级为可走网关 `messages.tts` 能力链路。
- 执行内容:
  - 数据层新增 TTS 能力：在 `GatewayDataClient` 增加 `getTtsStatus`、`setTtsProvider`、`convertTtsInlineAudio`、`loadTtsAudioBlob`。
  - 聊天页改造：
    - 发送后语音播报流程改为“网关 TTS 优先，失败回退浏览器播报”。
    - 新增 TTS 链路切换（网关/浏览器）、Provider 切换、状态刷新与状态展示。
    - 继续保留 Live2D text/voice 信号联动。
  - 本地开发代理：在 `savc-ui/vite.config.ts` 新增 `__savc/tts-file` 路由，允许从系统临时目录安全读取音频文件并回传给前端播放（限制后缀与目录）。
  - 网关侧增强（仓库源码）：`tts.convert` 新增可选 inline 音频返回（base64）支持，供前端优先直取音频。
  - 重启 `savc-ui` dev server，使新 Vite 中间件生效。
- 修改文件:
  - `savc-ui/src/ui/mock/index.ts`
  - `savc-ui/src/ui/views/chat.ts`
  - `savc-ui/vite.config.ts`
  - `openclaw/src/gateway/server-methods/tts.ts`
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `pnpm --dir savc-ui exec tsc -p tsconfig.json --noEmit` 通过。
  - `pnpm --dir savc-ui build` 通过。
  - `http://127.0.0.1:5174/` 返回 `200`，dev server 正常监听。
  - `GET /__savc/tts-file?path=%2Ftmp%2Fsavc-ui-tts-proxy-test.mp3` 返回 `200` 且 `Content-Type: audio/mpeg`。
- 备注:
  - 当前网关环境下 `tts.convert` 存在超时风险（外部 provider 链路不稳定），聊天页已实现自动回退浏览器播报，保证前端交互不中断。

## 24) Vibcoding 实际编排能力评估（代码层 vs 运行层）
- 对话目标: 回答“现在的 vibcoding 的实际编排能力怎么样”，给出可执行判断而非概念性描述。
- 执行内容:
  - 复核编排核心链路：`router` 路由、`decomposer` 任务拆解、`lifecycle` 执行分发与 `vibe-coder` 专用执行入口。
  - 复核网关运行态：检查 `savc-orchestrator` 插件是否已加载，确认当前在线环境是否真正接入该编排链路。
  - 用 CLI 进行样例路由/拆解调用，验证关键路径可返回结构化结果。
  - 运行关键测试（router/decomposer）确认基础能力未回归。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `openclaw plugins list` 显示当前仅加载 `discord`、`telegram`、`memory-core`，未加载 `savc-orchestrator`。
  - `openclaw config get --json plugins.entries.savc-orchestrator` 返回路径不存在（未启用）。
  - `node savc-core/orchestrator/router.mjs route --message "请帮我从零搭建一个前端脚手架并自动修复测试失败" --json` 返回 `agent=vibe-coder`。
  - `node savc-core/orchestrator/decomposer.mjs analyze --message "先写登录页面，然后写接口，再补测试" --json` 返回 `compound` 任务结构。
  - `node tests/orchestrator/router.test.mjs` 与 `node tests/orchestrator/decomposer.test.mjs` 均通过。
- 备注:
  - 当前可判定为“编排能力在代码与单测层已可用，但在线网关默认未接管会话流”。

## 25) 独立项目推进看板（Progress Hub）落地
- 对话目标: 按用户确认方案实现独立“项目推进看板”页面，并在 `savc-ui` 侧栏提供跳转入口；支持实时聚合日志/文档/提交状态与计划写入。
- 执行内容:
  - 新增 `progress-hub` 独立页面（不嵌入现有 tab）：`概览/甘特图/日志/计划` 四个视图，含神经元拓扑画布、模块详情抽屉、甘特时间轴、日志检索、计划编辑与历史回溯。
  - 扩展 `savc-ui` 的 Vite dev middleware：新增
    - `GET /__savc/progress/snapshot`
    - `GET /__savc/progress/stream`（SSE）
    - `POST /__savc/progress/plan`
  - 数据层实现对 `docs/worklog`、`docs/*.md`、`git log/status` 聚合读取；SSE 结合 `fs.watch` 与 15 秒心跳轮询兜底。
  - 新增计划持久化文档 `docs/project-plan-board.md`，按时间追加“下一步开发计划/错误更正计划”。
  - `savc-ui` 侧栏新增“推进看板”入口（外链打开 `/progress-hub/`），不改变当前 tab。
  - 启停联动：新增 `scripts/savc_ui_service.sh`（start/stop/restart/status），并接入 `scripts/start_project.ps1` 与 `scripts/stop_project.ps1`。
- 修改文件:
  - `savc-ui/vite.config.ts`
  - `savc-ui/public/progress-hub/index.html`
  - `savc-ui/public/progress-hub/styles.css`
  - `savc-ui/public/progress-hub/app.js`
  - `savc-ui/src/ui/navigation.ts`
  - `savc-ui/src/ui/i18n/zh-CN.ts`
  - `savc-ui/src/ui/app.ts`
  - `savc-ui/src/ui/app-render.ts`
  - `scripts/savc_ui_service.sh`
  - `scripts/start_project.ps1`
  - `scripts/stop_project.ps1`
  - `docs/project-plan-board.md`
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `pnpm --dir savc-ui exec tsc -p tsconfig.json --noEmit`：通过。
  - `pnpm --dir savc-ui build`：通过。
  - `curl --noproxy '*' http://127.0.0.1:5174/progress-hub/` 返回 `200`（在前台 dev 会话验证）。
  - `curl --noproxy '*' http://127.0.0.1:5174/__savc/progress/snapshot` 返回合法 JSON。
  - `curl --noproxy '*' -N http://127.0.0.1:5174/__savc/progress/stream` 收到 `event: snapshot`。
  - `POST /__savc/progress/plan` 返回 `{ ok: true }` 并成功追加 `docs/project-plan-board.md`。
- 备注:
  - 当前执行环境会在命令结束时回收后台子进程，`savc_ui_service.sh` 的常驻效果需在真实本机启动流程（非一次性命令会话）下使用。

## 26) 启动状态快速确认（网关 vs SAVC-UI）
- 对话目标: 回答“启动了吗”，确认当前服务运行状态。
- 执行内容:
  - 检查 `savc-ui` 服务状态：`bash scripts/savc_ui_service.sh status`。
  - 检查网关服务状态：`bash scripts/openclaw.sh gateway status`。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `savc-ui`：`stopped`。
  - OpenClaw Gateway：`running`，监听 `127.0.0.1:18789`，RPC probe `ok`。
- 备注:
  - 当前仅网关已启动，若需访问 `http://localhost:5174/progress-hub/` 需先启动 `savc-ui`。

## 27) 按请求启动 SAVC-UI 并验证 Progress Hub 可访问
- 对话目标: 用户要求“启动一下，我看看”。
- 执行内容:
  - 启动 `savc-ui` 开发服务。
  - 验证首页与独立推进看板地址可访问。
  - 验证 `progress` 聚合接口返回正常。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `http://127.0.0.1:5174/` 返回 `200`。
  - `http://127.0.0.1:5174/progress-hub/` 返回 `200`。
  - `GET /__savc/progress/snapshot` 返回合法 JSON。
- 备注:
  - 当前执行环境下后台进程会被自动回收，因此本次使用前台 dev 会话保持服务可用。

## 28) 修复推进看板跳转仍落在 SAVC-UI 首页的问题
- 对话目标: 用户反馈“点击跳转后还是 `savc-ui` 页面”，需要修复独立页面跳转行为。
- 执行内容:
  - 定位原因：`/progress-hub/` 在 dev 下被回退到主 `index.html`，导致看起来仍在 SAVC-UI。
  - 修复侧栏跳转目标为显式页面：`progress-hub/index.html`。
  - 在 Vite middleware 增加重定向兜底：访问 `/progress-hub` 或 `/progress-hub/` 时 `302` 到 `/progress-hub/index.html`。
  - 同步更新启动脚本输出的 Progress Hub 地址为 `http://localhost:5174/progress-hub/index.html`。
- 修改文件:
  - `savc-ui/src/ui/app.ts`
  - `savc-ui/vite.config.ts`
  - `scripts/start_project.ps1`
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `pnpm --dir savc-ui exec tsc -p tsconfig.json --noEmit` 通过。
  - `GET /progress-hub/` 返回 `302`，`Location: /progress-hub/index.html`。
  - `GET /progress-hub/index.html` 页面标题为 `SAVC 项目推进看板`（非主 `savc-ui` 页）。
  - `GET /progress-hub/`（跟随重定向）最终返回推进看板页面内容。
- 备注:
  - 当前会话已用前台 dev 方式验证路由行为，确保你点击后进入独立页面。

## 29) Progress Hub 页面改版为 ins 风格
- 对话目标: 用户反馈页面不够好看，要求改为 ins 风格。
- 执行内容:
  - 重构 `progress-hub` 整体视觉样式：从深色技术风切换为浅色胶片感 ins 风格。
  - 统一更新色板（粉橘渐变主色）、卡片玻璃拟态、圆角胶囊按钮、标签与状态色、输入框与滚动条样式。
  - 调整各核心区域（头部、全局状态条、tabs、概览、甘特图、日志、计划）的排版与层次，增强移动端适配表现。
- 修改文件:
  - `savc-ui/public/progress-hub/styles.css`
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `pnpm --dir savc-ui build` 通过。
  - `GET /progress-hub/index.html` 页面可正常返回，标题为 `SAVC 项目推进看板`。
- 备注:
  - 本轮仅调整视觉样式，不改动页面功能逻辑与接口协议。

## 30) 进度拓扑视图改造（模块元素化）与详情面板增强
- 对话目标: 用户反馈“球体视图不直观、右侧模块详情不够详细”，要求将每个模块展示关键功能元素并提升详情信息密度。
- 执行内容:
  - 拓扑画布改造：节点由圆球改为“模块卡片节点”，每个节点显示图标、模块名、状态/进度和 2 个关键功能元素标签。
  - 连线/命中逻辑重构：依赖线锚点改为矩形边缘锚点，点击命中改为矩形命中，保持依赖关系可读。
  - 新增模块元数据字典：为 10 个核心模块定义 `icon/elements/keywords/inputs/outputs/milestones/nextFocus`，用于概览和详情统一驱动。
  - 右侧详情增强：
    - 功能说明页：增加模块定位、关键元素、输入/输出、里程碑、关联文档。
    - 开发进度页：增加阶段 KPI 网格、进度线、周期/效率、关联提交与关联日志。
    - 依赖关系页：增加上游就绪率、阻塞依赖数、上下游依赖卡片及健康条。
    - 风险与下一步页：增加风险横幅、风险证据（日志）、下一步动作、可直接粘贴的纠偏草案模板。
  - 样式补充：新增详情卡片、tag pills、KPI 网格、依赖卡、风险横幅、细进度条等样式，以支持信息化展示。
- 修改文件:
  - `savc-ui/public/progress-hub/app.js`
  - `savc-ui/public/progress-hub/styles.css`
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `node --check savc-ui/public/progress-hub/app.js` 通过。
  - `pnpm --dir savc-ui build` 通过。
  - `bash scripts/savc_ui_service.sh status` 显示 `savc-ui: listening on :5174`。
- 备注:
  - 本轮保持数据接口协议不变，仅增强前端可视化与详情信息组织。

## 31) 日志/文档支持查看全文（不再仅摘要预览）
- 对话目标: 用户反馈“只能看预览，不能详细查看文件”，需提供完整文件浏览能力。
- 执行内容:
  - 新增安全文件读取接口：`GET /__savc/progress/file?path=...`，仅允许读取仓库 `docs/` 目录下 `.md` 文件。
  - 日志页与项目方案文档卡片新增“查看全文”按钮，点击后弹出文件详情面板显示完整 Markdown 内容。
  - 新增文件详情弹窗（标题、路径、正文、关闭/遮罩退出、Esc 关闭），支持滚动阅读。
  - Markdown 渲染增强：补充 `# / ## / 有序列表` 解析，提升完整文档阅读效果。
- 修改文件:
  - `savc-ui/vite.config.ts`
  - `savc-ui/public/progress-hub/index.html`
  - `savc-ui/public/progress-hub/app.js`
  - `savc-ui/public/progress-hub/styles.css`
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `node --check savc-ui/public/progress-hub/app.js` 通过。
  - `pnpm --dir savc-ui build` 通过。
  - `GET /__savc/progress/file?path=docs/worklog/2026-02-18.md` 返回 `ok=true` 且包含 `content` 全文。
  - 页面源码已包含 `file-preview` 弹窗结构与 `openFilePreview` 逻辑。
- 备注:
  - 仍保持路径安全边界：不支持读取 `docs/` 之外文件、也不支持非 markdown 文件。

## 32) 让 Progress Hub 服务跟随 `savc-ui` 启动并完成在线验证
- 对话目标: 用户反馈“页面服务没启动”，要求随 `savc-ui` 一起启动。
- 执行内容:
  - 复核启动链路脚本，确认以下路径都已联动 `savc-ui`：
    - `scripts/dev.sh`（开发模式启动时自动检测并拉起 `savc-ui`）
    - `scripts/start_project.ps1`（常规启动网关后自动拉起 `savc-ui`）
    - `scripts/stop_project.ps1`（停止时同步关闭 `savc-ui`）
  - 使用 `bash scripts/savc_ui_service.sh restart` 重启并验证 `savc-ui` 服务。
  - 校验页面与接口联动可用性：
    - `http://127.0.0.1:5174/`
    - `http://127.0.0.1:5174/progress-hub/index.html`
    - `GET /__savc/progress/snapshot`
    - `GET /__savc/progress/stream`
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `bash scripts/savc_ui_service.sh restart` 成功，服务监听 `:5174`。
  - `bash scripts/savc_ui_service.sh status` 显示 `savc-ui: listening on :5174`。
  - `curl --noproxy '*' -I http://127.0.0.1:5174/` 返回 `HTTP/1.1 200 OK`。
  - `curl --noproxy '*' -I http://127.0.0.1:5174/progress-hub/index.html` 返回 `HTTP/1.1 200 OK`。
  - `curl --noproxy '*' http://127.0.0.1:5174/__savc/progress/snapshot` 返回 `200`。
  - `curl --noproxy '*' -N http://127.0.0.1:5174/__savc/progress/stream` 收到 `event: snapshot`。
- 备注:
  - `/progress-hub/` 当前为 `302 -> /progress-hub/index.html`，属于预期重定向行为。

## 33) 按类别拆分并提交今日改动
- 对话目标: 用户要求将“今天所做改动”按类别分组提交。
- 执行内容:
  - 盘点全部变更并按功能域拆分为独立 commit。
  - 已完成以下分类提交：
    - `feat(gateway): support inline audio payload for tts.convert`（`e6e8b96b5`）
    - `chore(config): add optional silicon image env placeholders`（`affd4fcf6`）
    - `feat(savc-ui): switch core views to gateway-backed real data`（`4457f1387`）
    - `feat(progress-hub): add standalone project progress dashboard`（`ca9a1ac96`）
    - `chore(scripts): auto-manage savc-ui service with project lifecycle`（`a25d4a0e6`）
  - 准备将文档与日志改动单独归档提交。
- 修改文件:
  - `docs/worklog/2026-02-18.md`
- 验证结果:
  - `git status --short` 显示代码与脚本类改动已清空，仅剩文档/日志相关文件待提交。
- 备注:
  - 提交遵循“单一职责 + 可回滚”的分组策略，便于后续审阅与回退。
